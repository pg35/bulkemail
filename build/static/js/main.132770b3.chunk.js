(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{43:function(e,t){e.exports="data:image/gif;base64,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"},55:function(e,t,n){e.exports=n(75)},60:function(e,t,n){},75:function(e,t,n){"use strict";n.r(t);var a=n(27),r=n(15),s=n(16),o=n(18),l=n(17),i=n(19),c=n(0),A=n.n(c),m=n(24),u=n.n(m);n(60),n(43);var d=function(e){return Array.isArray(e.v)?e.v.map(function(t,n){return A.a.createElement("span",{key:n},A.a.createElement("strong",null,t),e.v.length-1!==n?", ":"")}):A.a.createElement("strong",null,e.v)};!function(e){function t(t,n,a,r,s){return e.apply(this,arguments)}t.toString=function(){return e.toString()}}(function(e,t,n,a,r){return("GET"===t?fetch(e+a):fetch(e,{method:t,headers:n,body:a})).then(function(e){if(e.status>=200&&e.status<300)return e;!function(e,t){var n=new Error(e);throw n.data=t,n}(e.statusText,e)})});var E=n(26);var p=function(e){return A.a.createElement("div",{className:"mesblkml-quota"},A.a.createElement("table",null,A.a.createElement("tbody",null,A.a.createElement("tr",null,A.a.createElement("th",{colSpan:"2",style:{textAlign:"center"}},"Quota")),A.a.createElement("tr",null,A.a.createElement("th",null,"Limit"),A.a.createElement("td",null,e.limit)),A.a.createElement("tr",null,A.a.createElement("th",null,"Remaining"),A.a.createElement("td",null,e.limit-e.used)),A.a.createElement("tr",null,A.a.createElement("th",null,"Next Renewal"),A.a.createElement("td",null,e.nextRenewal)))))},g=n(22);n(61);function v(e){if(!e)return"";var t=Object.keys(e);return t.length?"?"+t.map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&"):""}function h(e,t){var n=new Error(e);throw n.data=t,n}var f=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(l.a)(t).call(this,e))).state={fetching:!1,error:null},n}return Object(i.a)(t,e),Object(s.a)(t,[{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this,t=this.props,n=t.baseUrl,a=t.resource,r=t.method,s=t.data,o=t.onSuccess,l=t.onError,i=t.onComplete,c=t.onValidateResponse,A=n+(a?"/"+a:""),m={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)};this.setState({fetching:!0,error:null}),console.info(A,a,r,s,A+v(s)),(r&&"GET"!==r?fetch(A,m):fetch(A+v(s))).then(function(e){if(console.log(e),e.status>=200&&e.status<300)return e.json();h(e.statusText,e)}).then(function(e){c&&!c(e)&&h(e.errMsg?e.errMsg:"Invalid response",e),o&&o(e)}).catch(function(t){e.mounted?(e.setState({error:t}),l&&l(t)):console.log("json request::catching error when unmounted",t)}).finally(function(){e.mounted?(e.setState({fetching:!1}),i&&i()):console.log("json request::completed when unmounted")})})},{key:"componentDidMount",value:function(){this.fetch(),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this;if(this.state.fetching)return A.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},this.props.progressMessage," ..."," ",A.a.createElement("img",{src:"https://i.ibb.co/7V89Rtr/spinner.gif",alt:"loader gif"}));if(this.state.error){var t=this.state.error;console.log("a",t.message,t.name);var n=t.message;return!n&&t.response&&(n=t.response.status+" "+t.response.statusText),A.a.createElement("div",null,A.a.createElement(d,{v:"Failed: ".concat(this.props.progressMessage," ")}),n?"(".concat(n,") "):" ",this.props.canRetry&&A.a.createElement("button",{onClick:function(){e.fetch(),e.props.onRetry()}},"Retry"))}return null}}]),t}(A.a.Component);f.defaultProps={onValidateResponse:function(e){return!e.err},onRetry:function(){},canRetry:!0,baseUrl:window.ajaxurl};var B=f,w=function(e,t,n){return e>1?t:n},C={resumer:{pass:{hasLastEmail:"5d87715c340000c8370a14f7",noLastEmail:"5d87755434000021510a150e"}},quota:{pass:"5d857913320000410f07b267"},app:{hasSavedEmail:"",noSavedEmail:"5d87dc2034000094910a15c6"},delSavedEmail:{pass:""},progress:{pass:""},sender:{pass:""},previewer:{pass:""},error:{code500:"5d87ec3a3300006e00d7d704",custom:"5d8bfa142e00005100abd65f"}},b=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(l.a)(t).call(this,e))).state={deletingSavedEmail:!1},n}return Object(i.a)(t,e),Object(s.a)(t,[{key:"renderSavedEmailInfo",value:function(){var e=this,t=this.props.savedEmail,n=t.postcodes,a=t.sentCount,r=t.customerCount,s=r-a;return A.a.createElement("div",null,A.a.createElement("div",{className:"mes-para"},"Previously, email destined for"," ",w(n.length,"postcodes","postcode")+" ",A.a.createElement("span",null,A.a.createElement(d,{v:n.filter(function(e){return"*"!==e.value}).map(function(e){return e.value})}))," ","was sent to ",A.a.createElement(d,{v:a})," out of"," ",A.a.createElement(d,{v:r})," "+w(r,"customers","customer"),".",A.a.createElement("br",null),"It was saved to be sent to the remaining ",A.a.createElement(d,{v:s})," "+w(r,"customers","customer"),".",A.a.createElement("br",null),"Send it now or delete it."),A.a.createElement("div",{style:{marginTop:"20px"}},this.state.deletingSavedEmail?this.renderDeleteRequest():A.a.createElement("div",{className:"mes-stack"},A.a.createElement(g.a,{to:"/",onClick:function(t){window.confirm("The saved email is still to be sent to ".concat(s," ").concat(w(r,"customers","customer"),".\nAre you sure you want to delete it?"))?e.setState({deletingSavedEmail:!0}):t.preventDefault()}},"Delete Saved Email"),A.a.createElement(g.a,{to:"/preview",style:{marginLeft:"20px"}},"Preview & Send Saved Email"))))}},{key:"renderDeleteRequest",value:function(){var e=this,t=this.props,n=t.nonce,a=t.clientId;return A.a.createElement(B,{data:{action:"mesbulkemailerdelete",nonce:n,clientId:a},method:"POST",resource:C.error.code500&&C.delSavedEmail.pass,progressMessage:"Deleting saved email",onSuccess:function(t){console.log("delete saved email::",t),e.setState({deletingSavedEmail:!1}),e.props.onSavedEmailDelete()}})}},{key:"render",value:function(){var e=this.props.savedEmail?this.renderSavedEmailInfo():A.a.createElement(g.a,{to:"/compose"},"Compose Email");return A.a.createElement("div",null,e)}}]),t}(A.a.Component);var k=function(e){return console.log("homepage ",e),A.a.createElement("div",{id:"mesblkml-home"},A.a.createElement("h2",null,"Home"),A.a.createElement("p",null,"Send email to postcode to have it sent to all Woocommerce customers having the same billing postcode"),A.a.createElement(p,e.quota),A.a.createElement("br",null),A.a.createElement(b,e))};function Q(e){var t=e.isValid,n=e.invalidMsg;return A.a.createElement("div",{className:"mes-field ".concat(t?"":"mes-field--error")},A.a.createElement("div",null,e.children),t?null:A.a.createElement("div",{className:"mes-error"},n))}Q.defaultProps={invalidMsg:"required"};var S=Q,y=n(54),O=n(40),I=n(37),D=n(53),j=n(5),N=function(e){return e.allowSelectAll?A.a.createElement(I.a,Object.assign({},e,{options:[e.allOption].concat(Object(O.a)(e.options)),onChange:function(t,n){if(null!==t&&t.length>0){if(t[t.length-1].value===e.allOption.value)return e.onChange([e.allOption].concat(Object(O.a)(e.options)));var a=[];if(t.length===e.options.length)return t.includes(e.allOption)?a=t.filter(function(t){return t.value!==e.allOption.value}):"select-option"===n.action&&(a=[e.allOption].concat(Object(O.a)(e.options))),e.onChange(a)}return e.onChange(t)}})):A.a.createElement(I.a,e)};N.defaultProps={allOption:{label:"Select all",value:"*"}};var T=function(e){return A.a.createElement("div",null,A.a.createElement(j.z.Option,e,A.a.createElement("input",{type:"checkbox",checked:e.isSelected,onChange:function(){return null}})," ",A.a.createElement("label",null,e.label)))},M="*",x=function(e){var t=e.children,n=Object(y.a)(e,["children"]),a=t;return n.getValue().some(function(e){return e.value===M})&&(a=[[t[0][0]],t[1]]),A.a.createElement(j.z.ValueContainer,n,a)},J=function(e){var t="".concat(e.data.label,", ");return e.data.value===M&&(t="All Postcodes"),A.a.createElement(j.z.MultiValue,e,A.a.createElement("span",null,t))},K=Object(D.a)(),R=N;var H=function(e){var t=e.postcodes,n=e.subject,a=e.message,r=e.allPostcodes,s=e.readOnly,o=e.onChange,l=e.dirty,i=e.validation,c=e.onPostcodeChange,m=e.touched,u=r.map(function(e){return{value:e,label:e}});return A.a.createElement("div",{className:"mesblkml-composer"},A.a.createElement(S,{isValid:!l||!m.postcodes||i.postcodes},A.a.createElement("div",{style:{padding:"2px 0"}},A.a.createElement(R,{className:"mes-multiseclct",options:u,isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,components:{Option:T,MultiValue:J,ValueContainer:x,animatedComponents:K},onChange:c,allowSelectAll:!0,value:t,placeholder:"Select Postcode(s)"}))),A.a.createElement(S,{isValid:!l||!m.subject||i.subject},A.a.createElement("input",{type:"text",value:n,onChange:o,name:"subject",readOnly:s,placeholder:"Write Subject"})),A.a.createElement(S,{isValid:!l||!m.message||i.message},A.a.createElement("textarea",{value:a,onChange:o,name:"message",readOnly:s,rows:"10",placeholder:"Write Message"})),A.a.createElement(S,{isValid:!0},"*use [name] to insert customer billing name in the message e.g. Hi [name], ...."))};var q=function(e){var t=e.email.dirty?A.a.createElement("div",{className:"mes-hvcenter"},function(){var t=e.email.postcodes.filter(function(e){return"*"!==e.value}).map(function(e){return e.value}).join(",");return A.a.createElement(B,{data:{action:"mesbulkemailerpreview",postcodes:t},resource:C.error.code500&&C.previewer.pass,progressMessage:"Generating preview",onSuccess:function(t){console.log("preview::",t),e.onPreviewGenerate(t)}})}()):function(){var t=e.email,n=t.postcodes,a=t.subject,r=t.message,s=e.progress,o=s.sentCount,l=s.customerCount,i=e.quota,c=i.limit,m=i.used,u=e.isNewEmail,E=l-o,p=c-m,g=p?E>p?"There is not enough quota remaining to send ".concat(E," emails. Only ").concat(p," emails can be sent."):"":"Quota has already been consumed";return A.a.createElement("div",null,A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},w(n.length,"Postcodes","Postcode")),A.a.createElement("div",{className:"mes-row__detail"},A.a.createElement(d,{v:n.filter(function(e){return"*"!==e.value}).map(function(e){return e.value})})," ","(",n.length>1?"all ":"","having"," ",n.length>1?"total ":"",A.a.createElement(d,{v:l})," ",w(l,"customers","customer"),")")),A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},"Subject"),A.a.createElement("div",{className:"mes-row__detail"},a)),A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},"Message"),A.a.createElement("div",{className:"mes-row__detail",style:{border:"1px dotted #000"},dangerouslySetInnerHTML:{__html:r.replace(/(?:\r\n|\r|\n)/g,"<br/>")}})),A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},"Total customers to serve"),A.a.createElement("div",{className:"mes-row__detail"},l," ",A.a.createElement("small",null,"(emails will need to be sent for selected postcodes)"))),!u&&A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},"Customers already served"),A.a.createElement("div",{className:"mes-row__detail"},o," ",A.a.createElement("small",null,"(emails have already been sent)"))),!u&&A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},"Customers remaining to be served"),A.a.createElement("div",{className:"mes-row__detail"},E," ",A.a.createElement("small",null,"(emails are remaining to be sent)"))),A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},"Qutoa"),A.a.createElement("div",{className:"mes-row__detail"},c)),A.a.createElement("div",{className:"mes-row"},A.a.createElement("div",{className:"mes-row__heading"},"Remaining Qutoa"),A.a.createElement("div",{className:"mes-row__detail"},p)),A.a.createElement("div",{className:"mes-row",style:{marginTop:"2em"}},A.a.createElement("small",null,A.a.createElement("strong",null,"Processing Info:"),A.a.createElement("br",null),"- Emails will be sent until all emails are sent, qutoa rans out or some unexpected error occurs.",A.a.createElement("br",null),"- If quota is renewed during the processing, it will be consumed.",A.a.createElement("br",null),"- If not all emails are sent, data will be saved to resume the processing later to send remaining emails.",A.a.createElement("br",null))),g&&A.a.createElement("div",{className:"mes-row mes-blkml-preview__feedback"},g))}();return A.a.createElement("div",null,t)},L=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(l.a)(t).call(this,e))).state={fetching:!0},n}return Object(i.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"renderFetchRequest",value:function(){var e=this;return A.a.createElement(B,{data:{action:"mesbulkemailerprogress"},resource:C.error.code500&&C.progress.pass,progressMessage:"Fetching progress",onSuccess:function(t){console.log(e.props),e.mounted&&e.props.onSentCountChange(t.sentCount)},onComplete:function(){e.mounted&&e.setState({fetching:!1}),e.props.stop||setTimeout(function(){return e.mounted&&e.setState({fetching:!0})},e.props.delay||2e3)}})}},{key:"render",value:function(){var e=this.props,t=e.stop,n=e.sentCount,a=e.customerCount;return A.a.createElement("div",{className:"mesblkml-progress"},A.a.createElement("div",{className:"mesblkml-progress__stats"},A.a.createElement("span",null,n)," / ",A.a.createElement("span",null,a)," ",A.a.createElement("span",null,"emails sent")),A.a.createElement("div",{className:"mesblkml-progress__status"},!t&&this.state.fetching?this.renderFetchRequest():A.a.createElement("div",null,"\xa0")))}}]),t}(A.a.Component),P=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(l.a)(t).call(this,e))).state={sending:!0,fetchProgress:!0,message:"",sentCount:0,customerCount:0},n}return Object(i.a)(t,e),Object(s.a)(t,[{key:"renderSendRequest",value:function(){var e=this,t=this.props,n=t.email,a=n.postcodes,r=n.subject,s=n.message,o=t.progress.clientId,l=t.isNewEmail,i=t.nonce,c=a.filter(function(e){return"*"!==e.value}).map(function(e){return e.value}).join(",");return A.a.createElement(B,{data:{action:"mesbulkemailersend",nonce:i,postcodes:c,subject:r,message:s,clientId:o,isnew:l?"yes":"no"},method:"POST",canRetry:!1,resource:C.error.code500&&C.sender.pass,progressMessage:"Processing",onSuccess:function(t){return e.setState({sending:!1,message:t.msg,sentCount:t.sentCount,customerCount:t.customerCount})},onError:function(t){return e.setState({fetchProgress:!1})},onRetry:function(){return e.setState({fetchProgress:!0})}})}},{key:"render",value:function(){var e=this.state,t=e.sending,n=e.fetchProgress,a=e.message,r=this.props,s=r.progress,o=s.sentCount,l=s.customerCount,i=r.onRestart,c=r.onSentCountChange,m=t?A.a.createElement("div",null,A.a.createElement("div",{className:"mesblkml-sender__status"},this.renderSendRequest()),A.a.createElement(L,{sentCount:o,customerCount:l,stop:!n,onSentCountChange:c}),!n&&A.a.createElement("div",{className:"mesblkml-retart"},A.a.createElement(g.a,{to:"/",onClick:function(){i()}},"Home"))):A.a.createElement("div",null,A.a.createElement(L,{stop:!0,sentCount:this.state.sentCount,customerCount:this.state.customerCount,onSentCountChange:function(){}}),A.a.createElement("div",{className:"mesblkml-result"},A.a.createElement("div",null,"Completed"),A.a.createElement("div",null,a)),A.a.createElement("div",{className:"mesblkml-retart"},A.a.createElement(g.a,{to:"/",onClick:function(){i()}},"Home")),A.a.createElement("div",null));return A.a.createElement("div",{className:"mesblkml-sender"},m)}}]),t}(A.a.Component);var U=function(e){var t=e.prevPath,n=e.prevLabel,a=e.onPrev,r=e.nextPath,s=e.nextLabel,o=e.onNext,l=function(){};return A.a.createElement("div",{className:"mesblkml-navigation"},t?A.a.createElement(g.a,{to:t,onClick:a||l},n||"Previous"):null,r?A.a.createElement(g.a,{to:r,onClick:o||l},s||"Next"):null)};function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(n,!0).forEach(function(t){Object(a.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var G=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(l.a)(t).call(this,e))).handleSavedEmailDelete=function(){n.setState({isNewEmail:!0,email:n.buildEmailObj(null),progress:n.buildProgressObj(null)})},n.handleEmailDraftChange=function(e){var t,r=e.target,s=r.name,o=r.value;n.setState({email:Y({},n.state.email,(t={},Object(a.a)(t,s,o),Object(a.a)(t,"dirty",!0),Object(a.a)(t,"touched",Y({},n.state.email.touched,Object(a.a)({},s,1))),t))})},n.handlePostcodeChange=function(e){n.setState({email:Y({},n.state.email,{postcodes:e,dirty:!0,touched:Y({},n.state.email.touched,{postcodes:1})})})},n.handleSentCountChange=function(e){n.setState({progress:Y({},n.state.progress,{sentCount:e})})},n.handlerPreviewGenerate=function(e){var t={email:Y({},n.state.email,{dirty:!1})};n.state.isNewEmail&&(t.progress=Y({},n.state.progress,{customerCount:e.customerCount})),n.setState(t)},n.handleRestart=function(){return n.setState(function(e){return{initCount:e.initCount+1}})},n.state={initCount:0,isNewEmail:!0,email:{postcodes:null,subject:"",message:"",dirty:!1,touched:{}},progress:{sentCount:0,customerCount:0,clientId:""},quota:{limit:0,used:0,nextRenewal:""},nonce:""},n}return Object(i.a)(t,e),Object(s.a)(t,[{key:"buildEmailObj",value:function(e){var t=e&&e.postcodes||null;return t&&(t=t.split(",").map(function(e){return{label:e,value:e}})),console.log("fetched postcd",t),{postcodes:t,subject:e&&e.subject||"",message:e&&e.message||"",dirty:!!e,touched:{}}}},{key:"buildProgressObj",value:function(e){return{sentCount:e&&e.sentCount||0,customerCount:e&&e.customerCount||0,clientId:e&&e.clientId||Date.now()}}},{key:"renderInitRequest",value:function(){var e=this;return A.a.createElement(B,{data:{action:"mesbulkemailerinit"},resource:C.error.custom&&C.app.hasSavedEmail,progressMessage:this.state.initCount?"Fetching status":"Initializing App",onSuccess:function(t){console.log("app::",t),e.setState(function(n){return{initCount:n.initCount+1,isNewEmail:!t.savedEmail,email:e.buildEmailObj(t.savedEmail),progress:e.buildProgressObj(t.savedEmail),quota:t.quota,nonce:t.nonce}})},onComplete:function(){return"app oncomplete called"}})}},{key:"componentWillUnmount",value:function(){console.log("app: unmounting")}},{key:"render",value:function(){var e=this;console.log("app state",this.state);var t=this.state,n=t.initCount,r=t.isNewEmail,s=t.email,o=t.progress,l=t.quota,i=t.nonce,c=Object.keys(s).filter(function(e){return"dirty"!==e&&"touched"!==e}).reduce(function(e,t){return Y({},e,Object(a.a)({},t,s[t]&&(Array.isArray(s[t])?!!s[t].length:!!String(s[t]).trim())))},{}),m=Object.keys(c).filter(function(e){return!c[e]}).length;return console.log(c,m),n%2?A.a.createElement(E.a,{initialEntries:["/","/compose","/preview"]},A.a.createElement(E.d,null,A.a.createElement(E.b,{path:"/",exact:!0,render:function(){return A.a.createElement(k,{quota:l,savedEmail:r?null:Y({},s,{},o),nonce:i,clientId:o.clientId,onSavedEmailDelete:e.handleSavedEmailDelete})}}),A.a.createElement(E.b,{path:"/compose",exact:!0,render:function(){return A.a.createElement("div",{id:"mesblkml-compose"},A.a.createElement("h2",null,"Compose Email"),A.a.createElement(H,Object.assign({},e.state.email,{allPostcodes:e.props.allPostcodes,onChange:e.handleEmailDraftChange,validation:c,onPostcodeChange:e.handlePostcodeChange})),A.a.createElement(U,{prevPath:"/",prevLabel:"Home",nextPath:"/preview",nextLabel:"Preview",onNext:function(t){var n=e.state.email.dirty;e.setState({email:Y({},e.state.email,{dirty:!0,touched:{postcodes:1,subject:1,message:1}})}),m?t.preventDefault():e.setState({email:Y({},e.state.email,{dirty:n,touched:{}})})}}))}}),A.a.createElement(E.b,{path:"/preview",exact:!0,render:function(){return A.a.createElement("div",{id:"mesblkml-preview"},A.a.createElement("h2",null,"Preview Email"),A.a.createElement(q,Object.assign({},e.state,{onPreviewGenerate:e.handlerPreviewGenerate})),A.a.createElement(U,{prevPath:r?"/compose":"/",prevLabel:r?"Compose":"Home",nextPath:"/process",nextLabel:"Confirm & Send",onNext:function(e){window.confirm("Are you sure to send this email?")||e.preventDefault()}}))}}),A.a.createElement(E.b,{path:"/process",exact:!0,render:function(){return A.a.createElement("div",{id:"mesblkml-process"},A.a.createElement("h2",null,"Sending Email"),A.a.createElement("p",null,A.a.createElement("small",null,"having")," subject"," ",A.a.createElement(d,{v:e.state.email.subject})),A.a.createElement("p",null,A.a.createElement("small",null,"to")," ",w(e.state.email.postcodes.length,"postcodes","postcode")," ",A.a.createElement(d,{v:e.state.email.postcodes.filter(function(e){return"*"!==e.value}).map(function(e){return e.value})})),A.a.createElement(P,Object.assign({},e.state,{onSentCountChange:e.handleSentCountChange,onRestart:e.handleRestart})))}}))):A.a.createElement("div",{className:"mes-hvcenter"},this.renderInitRequest())}}]),t}(A.a.Component);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(n,!0).forEach(function(t){Object(a.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Z=["BT1","BT2","BT3","BT4","BT5","BT6","BT7","BT8","BT9","BT10","BT11","BT12","BT13","BT14","BT15","BT16","BT17","BT18","BT19","BT20","BT21","BT22","BT23","BT24","BT25","BT26","BT27","BT28","BT32","BT36","BT37","BT38","BT61","BT62","BT63","BT64","BT65","BT66","BT67"];A.a.Component;var V=document.getElementById("mesblkml");u.a.render(A.a.createElement(function(){return A.a.createElement(G,{allPostcodes:Z})},null),V)}},[[55,1,2]]]);
//# sourceMappingURL=main.132770b3.chunk.js.map